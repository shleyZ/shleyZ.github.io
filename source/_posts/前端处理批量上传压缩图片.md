---
title: 前端处理批量上传图片的解压缩
date: 2019-02-26 18:08:51
categories: javascript
tags: 批量上传图片
---

一般前端对于批量图片压缩包只进行上传，后台进行文件处理  
但是前端也实现解压并验证之后进行上传，多用在批量添加人员时，人脸验证/图片处理，进而进行人员的创建与提示。这样可以加速上传的过程，也可以实现前端的定制化的验证。

#### 解压缩

``` js
import JsZip from 'jszip';

var newZip = new JsZip();
// 获取解压缩的文件
newZip
  .loadAsync(file, { base64: true })
  .then(function(file) {
    console.log(file)
  })
  .then(function(content) {
    console.log(content);
  });
```

#### 遍历对象 处理解压过后的ZipObject

``` js
Object.keys(content).forEach(key => {
  content[key].async('base64').then(async function(base64) {
    basicInfo.face = 'data:image/jpeg;base64,' + base64;
    content[key].face = 'data:image/jpeg;base64,' + base64;

    let tempArr = content[key].name.split('-'); // 0姓名-1性别-2手机号.jpg
    if (tempArr.length < 3) {
      // 命名不规范
      uploadUser.push({
        face: base64,
        name: content[key].name,
        msg: '命名不规范',
      });
      _vm.showUploadUser = true;
      _vm.$notify.error(`${content[key].name}命名不规范`);
      return;
    } else if (
      tempArr[0] === '' ||
      tempArr[1] === '' ||
      tempArr[2] === ''
    ) {
      uploadUser.push({
        face: base64,
        name: content[key].name,
        msg: '姓名性别和手机号不能为空',
      });
      _vm.showUploadUser = true;
      _vm.$notify.error(`${content[key].name}姓名性别和手机号不能为空`);
      return;
    } else if (!/^1[345789]\d{9}$/.test(tempArr[2].split('.')[0])) {
      uploadUser.push({
        face: base64,
        name: content[key].name,
        msg: '手机号码有误',
      });
      _vm.showUploadUser = true;
      _vm.$notify.error(`${content[key].name}手机号码有误`);
      return;
    }
    basicInfo.userName = tempArr[0];
    basicInfo.gender = tempArr[1] === '男' ? 1 : 2;
    basicInfo.phone = tempArr[2].split('.')[0];
    _vm.batchLoading = true;

    await _vm
      .$post('/api/basics/sysUser', basicInfo)
      .then(response => {
        if (response.code == 200) {
          uploadUser.push({
            face: base64,
            name: content[key].name,
            msg: '上传成功',
            status: 'success',
          });
          _vm.getUserManageData();
          _vm.batchLoading = false;
        } else {
          uploadUser.push({
            face: base64,
            name: content[key].name,
            msg: response.msg,
          });
          _vm.batchLoading = false;
          _vm.$notify.error({
            message: response.msg,
          });
        }
      })
      .catch(error => {
        uploadUser.push({
          face: base64,
          name: content[key].name,
          msg: error,
        });
        _vm.batchLoading = false;
        _vm.$notify.error({
          message: this.$error2message(error),
        });
      });
  });
  _vm.uploadUser = uploadUser;
  console.log(uploadUser);
});  

```      